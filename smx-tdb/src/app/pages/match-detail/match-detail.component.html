<div class="match-detail-container">
  <app-back-to-search></app-back-to-search>

  <div *ngIf="isLoading" class="loading-section">
    <mat-spinner diameter="50"></mat-spinner>
    <p>Loading match...</p>
  </div>

  <div *ngIf="error" class="error-section">
    <mat-icon class="error-icon">error</mat-icon>
    <h2>Error</h2>
    <p>{{ error }}</p>
    <button mat-raised-button color="primary" (click)="router.navigate(['/'])">
      Return to Home
    </button>
  </div>

  <div *ngIf="!isLoading && !error && match" class="match-detail-content">
    <div class="header-section">
      <mat-icon class="header-icon">sports_esports</mat-icon>
      <div class="header-text">
        <h1>{{ getMatchDisplayText() }}</h1>
        <p *ngIf="match.event" class="header-event">
          <mat-icon class="small-icon">event</mat-icon>
          <a (click)="navigateToEvent(match.event_id)" class="event-link">{{ match.event.name }}</a>
          <span *ngIf="match.event.date"> - {{ match.event.date | date:'shortDate' }}</span>
        </p>
      </div>
    </div>

    <!-- Match Information -->
    <mat-card class="detail-card">
      <mat-card-header>
        <mat-card-title>Match Information</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div class="info-grid">
          <div class="info-item" *ngIf="match.round">
            <mat-icon class="info-icon">tournament</mat-icon>
            <div class="info-content">
              <span class="info-label">Round</span>
              <span class="info-value">{{ match.round }}</span>
            </div>
          </div>

          <div class="info-item" *ngIf="match.winner">
            <mat-icon class="info-icon winner-icon">emoji_events</mat-icon>
            <div class="info-content">
              <span class="info-label">Winner</span>
              <span class="info-value winner-text">
                <a (click)="navigateToPlayer(match.winner!.player_id)" class="player-link">
                  {{ match.winner.gamertag }}
                </a>
              </span>
            </div>
          </div>
        </div>
      </mat-card-content>
    </mat-card>

    <!-- Player Stats Section -->
    <mat-card class="detail-card" *ngIf="match.player_stats && match.player_stats.length > 0">
      <mat-card-header>
        <mat-card-title>Player Statistics</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div class="stats-table">
          <div class="stats-header">
            <span>Player</span>
            <span>Wins</span>
            <span>Losses</span>
            <span>Draws</span>
            <span>Total</span>
          </div>
          <div *ngFor="let stat of match.player_stats" class="stats-row">
            <a (click)="navigateToPlayer(stat.player_id)" class="player-link">{{ stat.gamertag }}</a>
            <span>{{ stat.wins }}</span>
            <span>{{ stat.losses }}</span>
            <span>{{ stat.draws }}</span>
            <span class="total">{{ stat.wins + stat.losses + stat.draws }}</span>
          </div>
        </div>
      </mat-card-content>
    </mat-card>

    <!-- Songs Section -->
    <mat-card class="detail-card" *ngIf="match.songs && match.songs.length > 0">
      <mat-card-header>
        <mat-card-title>Songs</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div class="songs-list">
          <div *ngFor="let song of match.songs; let i = index" class="song-item">
            <div class="song-header">
              <span class="song-number">{{ i + 1 }}</span>
              <div class="song-info">
                <h3>{{ song.title || 'Unknown Song' }}</h3>
                <p *ngIf="song.artist" class="song-artist">{{ song.artist }}</p>
                <p *ngIf="song.chart_display" class="song-chart">{{ song.chart_display }}</p>
              </div>
            </div>
            
            <div class="song-scores" *ngIf="song.player_scores && song.player_scores.length > 0">
              <div *ngFor="let score of song.player_scores" class="score-item" [class.winner]="score.win">
                <span class="player-name">
                  <a (click)="navigateToPlayer(score.player_id)" class="player-link">{{ score.player_gamertag }}</a>
                  <mat-icon *ngIf="score.win" class="win-icon">star</mat-icon>
                </span>
                <span class="score-value">{{ score.score !== null && score.score !== undefined ? score.score : 'N/A' }}</span>
              </div>
              <div class="song-winner">
                <mat-icon class="winner-icon">emoji_events</mat-icon>
                <span>Winner: {{ getSongWinner(song) }}</span>
              </div>
            </div>
          </div>
        </div>
      </mat-card-content>
    </mat-card>

    <div class="placeholder-section" *ngIf="!match.players && !match.songs && !match.player_stats">
      <mat-icon>info</mat-icon>
      <p>Additional match information will be displayed here as it becomes available.</p>
    </div>
  </div>
</div>

